:root{
  --bgDim:.35;

  --bookW: min(520px, 72vw);
  --bookAspect: 1.38; /* book image feels like 3:4-ish but slightly wider */
  --tilt: 20deg;

  --glowA: rgba(255, 170, 60, .18);
  --glowB: rgba(255, 110, 35, .14);

  --ease: cubic-bezier(.2,.9,.2,1);
  --shadow: 0 24px 55px rgba(0,0,0,.62);
}

*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  overflow:hidden;
  color:#efe6d8;
  font-family: ui-serif, Georgia, serif;
  background:#07070a;
}

/* Desk background */
.desk{
  position:fixed;
  inset:0;
  z-index:-2;
  background: url("./assets/desk-bg.png") center / cover no-repeat;
  transform: translateZ(0);
}
.desk::after{
  content:"";
  position:absolute;
  inset:0;
  background:
    radial-gradient(120% 80% at 50% 30%, rgba(255,255,255,.06), transparent 60%),
    linear-gradient(180deg, rgba(0,0,0,var(--bgDim)), rgba(0,0,0,var(--bgDim)));
}

/* Stage */
.stage{
  height:100%;
  display:grid;
  place-items:center;
  padding: clamp(16px, 3vw, 32px);
}

/* Book zone matches “slightly off-center” resting placement */
.book-zone{
  position:relative;
  width: min(1100px, 96vw);
  height: min(700px, 86vh);
  display:grid;
  align-items:end;
  justify-items:start;
  padding: clamp(16px, 2.5vw, 34px);
}

/* Ember canvas sits over the desk area */
.embers{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  pointer-events:none;
  opacity:0;
  transition: opacity 260ms var(--ease);
  filter: blur(.2px);
}

/* Book button */
.book{
  position:relative;
  border:none;
  background:transparent;
  padding:0;
  cursor:pointer;
  outline: none;

  /* perspective container so rotateX feels real */
  transform-style: preserve-3d;
  perspective: 1200px;

  /* “resting” placement: a little left and lower */
  margin-left: clamp(10px, 3vw, 48px);
  margin-bottom: clamp(0px, 1.5vw, 12px);
}

/* The “book image” */
.book-img{
  display:block;
  width: var(--bookW);
  aspect-ratio: 4 / 3; /* keep consistent footprint; image itself controls feel */
  background: url("./assets/book-frame_01.png") center / contain no-repeat;

  /* Resting pose: subtle desk sit */
  transform:
    rotateX(0deg)
    rotateZ(-2.2deg)
    translateZ(0);

  filter: drop-shadow(var(--shadow));
  transition:
    transform 620ms var(--ease),
    filter 420ms var(--ease);
  will-change: transform, filter;
}

/* Contact shadow under the book (helps “sitting on desk”) */
.book-shadow{
  content:"";
  position:absolute;
  left: 8%;
  right: 6%;
  bottom: 6%;
  height: 22%;
  border-radius: 50%;
  background: radial-gradient(closest-side, rgba(0,0,0,.55), transparent 70%);
  transform: translateZ(-1px) rotateZ(-2.2deg);
  filter: blur(10px);
  opacity:.75;
  transition: opacity 420ms var(--ease), transform 620ms var(--ease);
  pointer-events:none;
}

/* Intentional “click” hint only after rotation completes */
.book-hint{
  position:absolute;
  left: 50%;
  bottom: -10px;
  transform: translateX(-50%);
  font-size: 12px;
  letter-spacing: .22em;
  text-transform: uppercase;
  opacity:0;
  transition: opacity 240ms var(--ease);
  color: rgba(240,230,216,.78);
  text-shadow: 0 10px 25px rgba(0,0,0,.65);
  pointer-events:none;
}

/* Hover state: glow + embers + ritual tilt (20° toward viewer) */
.book-zone.is-hover .embers{ opacity:1; }

.book-zone.is-hover .book-img{
  transform:
    rotateX(var(--tilt))
    rotateZ(-2.2deg)
    translateY(-6px)
    translateZ(10px);
  filter:
    drop-shadow(0 28px 65px rgba(0,0,0,.70))
    drop-shadow(0 0 30px var(--glowA))
    drop-shadow(0 0 52px var(--glowB));
}

.book-zone.is-hover .book-shadow{
  opacity:.92;
  transform: translateZ(-1px) rotateZ(-2.2deg) scale(1.03);
}

/* “Armed” means rotation finished; now show hint */
.book-zone.is-armed .book-hint{ opacity:.9; }

/* Pickup animation before reader opens */
.book-zone.is-picking .book-img{
  transform:
    rotateX(26deg)
    rotateZ(-1.6deg)
    translateY(-22px)
    translateZ(40px)
    scale(1.02);
}
.book-zone.is-picking .book-shadow{ opacity:.55; transform: translateZ(-1px) rotateZ(-2.2deg) scale(.98); }

/* Reader */
.reader[hidden]{ display:none; }
.reader{
  position:fixed;
  inset:0;
  z-index:60;
}
.reader-backdrop{
  position:absolute;
  inset:0;
  background: rgba(0,0,0,.72);
  backdrop-filter: blur(5px);
}
.reader-panel{
  position:absolute;
  left:50%;
  top:50%;
  transform: translate(-50%, -50%);
  width: min(980px, calc(100% - 24px));
  max-height: min(86vh, 900px);
  overflow:hidden;
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,.12);
  background:
    linear-gradient(180deg, rgba(255,255,255,.06), transparent 55%),
    rgba(10,10,14,.72);
  box-shadow: 0 26px 80px rgba(0,0,0,.65);
}
.reader-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding: 12px 14px;
  border-bottom: 1px solid rgba(255,255,255,.10);
}
.reader-title{
  letter-spacing:.08em;
  font-size: 14px;
  text-transform: uppercase;
  opacity:.9;
}
.reader-close{
  appearance:none;
  border:none;
  background: transparent;
  color:#f2e8d9;
  font-size: 20px;
  cursor:pointer;
  opacity:.85;
}
.reader-close:hover{ opacity:1; }

.reader-body{
  padding: 14px;
  overflow:auto;
  max-height: calc(86vh - 54px);
  -webkit-overflow-scrolling: touch;
}

/* Placeholder spread */
.spread{
  position:relative;
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  border-radius: 16px;
  padding: 12px;
  background: rgba(0,0,0,.18);
  border: 1px solid rgba(255,255,255,.10);
}
.page{
  min-height: min(68vh, 660px);
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(120% 90% at 50% 20%, rgba(255,255,255,.06), transparent 55%),
    rgba(15,12,10,.35);
  position:relative;
  overflow:hidden;
}
.page-inner{
  padding: 18px;
  line-height: 1.45;
}
.sigil{
  font-size: 22px;
  letter-spacing:.06em;
  margin-bottom: 10px;
}
.muted{ opacity:.75; }

/* Click zones for next/prev pages (we wire behavior later) */
.nav-zone{
  position:absolute;
  top: 0;
  bottom: 0;
  width: 22%;
  border:none;
  background: transparent;
  cursor:pointer;
}
.nav-left{ left:0; }
.nav-right{ right:0; }

/* Reduced motion safety */
@media (prefers-reduced-motion: reduce){
  .book-img, .book-shadow, .embers, .book-hint{ transition:none !important; }
}