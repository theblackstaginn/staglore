/* =========================================================
   Stag Lore — Desk Grimoire (CLOSED BOOK ONLY)
   - Desk background fixed
   - Book sits on desk (contact + ambient shadow)
   - Hover glow + embers
   - Intentional hover beat (hint appears after a pause)
   - Click = pickup micro-lift (no reader mode yet)
   ========================================================= */

:root{
  --deskDim: .30;

  --glow: rgba(255,150,70,.22);
  --glow2: rgba(255,105,35,.14);

  --text: rgba(245,240,230,.92);

  --ease: cubic-bezier(.2,.9,.2,1);
}

*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  background:#050608;
  overflow:hidden;
  color:var(--text);
  font-family: ui-serif, Georgia, "Times New Roman", serif;
}

/* =========================
   BACKGROUND
   ========================= */
.bg{
  position:fixed;
  inset:0;
  z-index:-5;
  background: url("./assets/desk-bg.png") center / cover no-repeat;
  transform: translateZ(0);
}

.atmos{
  position:fixed;
  inset:0;
  z-index:-4;
  pointer-events:none;
  background:
    radial-gradient(120% 85% at 55% 12%, rgba(255,210,160,.10), transparent 58%),
    radial-gradient(140% 140% at 50% 55%, transparent 52%, rgba(0,0,0,.78) 100%),
    linear-gradient(180deg, rgba(0,0,0,var(--deskDim)), rgba(0,0,0,calc(var(--deskDim) + .18)));
}

/* =========================
   STAGE
   ========================= */
.stage{
  position:relative;
  height:100%;
  width:100%;
}

/* =========================
   BOOK PLACEMENT (desk plane)
   ========================= */
.book-anchor{
  appearance:none;
  border:none;
  background:transparent;
  padding:0;
  cursor:pointer;

  position:absolute;

  /* Off-center placement; tuned for “book on desk” feel */
  left: 18%;
  top: 54%;

  width: min(520px, 62vw);
  aspect-ratio: 4 / 3;

  transform: translateZ(0);
  outline: none;
}

/* Keyboard focus */
.book-anchor:focus-visible{
  outline: 2px solid rgba(255,220,170,.55);
  outline-offset: 12px;
  border-radius: 18px;
}

/* =========================
   SHADOWS (this stops hovering)
   ========================= */

/* Tight contact shadow: where the book touches the wood */
.shadow-contact{
  position:absolute;
  left: 12%;
  top: 64%;
  width: 76%;
  height: 20%;
  border-radius: 999px;
  background: radial-gradient(closest-side, rgba(0,0,0,.62), transparent 70%);
  filter: blur(10px);
  opacity:.90;

  /* squash to desk plane */
  transform: perspective(1200px) rotateX(78deg) rotateZ(-2deg);
  transform-origin: 50% 50%;

  transition: opacity 520ms var(--ease), filter 520ms var(--ease), transform 520ms var(--ease);
  pointer-events:none;
  z-index:0;
}

/* Ambient shadow: softer spill */
.shadow-ambient{
  position:absolute;
  left: 6%;
  top: 60%;
  width: 86%;
  height: 30%;
  border-radius: 999px;
  background: radial-gradient(closest-side, rgba(0,0,0,.42), transparent 78%);
  filter: blur(18px);
  opacity:.55;
  transform: perspective(1200px) rotateX(78deg) rotateZ(-2deg);
  transition: opacity 520ms var(--ease), filter 520ms var(--ease), transform 520ms var(--ease);
  pointer-events:none;
  z-index:0;
}

/* =========================
   BOOK IMAGE (locked asset)
   ========================= */
.book{
  position:absolute;
  left:0;
  top:0;
  width:100%;
  height:auto;
  display:block;
  z-index:2;

  /* Base resting pose: “sitting” */
  transform-origin: 42% 72%;
  transform:
    perspective(1200px)
    rotateX(10deg)
    rotateY(-18deg)
    rotateZ(-2deg)
    translateY(7px);

  filter:
    drop-shadow(0 22px 22px rgba(0,0,0,.36))
    drop-shadow(0 6px 10px rgba(0,0,0,.24));

  transition: transform 520ms var(--ease), filter 520ms var(--ease);
  user-select:none;
  -webkit-user-drag:none;
}

/* =========================
   EMBERS
   ========================= */
.embers{
  position:absolute;
  inset:-12% -12% -12% -12%;
  pointer-events:none;
  z-index:1;
}

/* Ember particle */
.ember{
  position:absolute;
  width: 5px;
  height: 5px;
  border-radius: 999px;
  opacity: 0;

  background: radial-gradient(circle,
    rgba(255,185,85,.95),
    rgba(255,120,40,.80),
    transparent 70%);

  animation: emberRise var(--dur, 1600ms) ease-out forwards;
}

@keyframes emberRise{
  0%{
    transform: translate(var(--x, 0px), var(--y, 0px)) scale(.7);
    opacity: 0;
  }
  12%{ opacity: .95; }
  100%{
    transform: translate(calc(var(--x, 0px) + var(--dx, 0px)),
                         calc(var(--y, 0px) - var(--lift, 90px))) scale(0);
    opacity: 0;
  }
}

/* =========================
   INTENTIONAL BEAT + HINT
   ========================= */
.hint{
  position:absolute;
  left: 26%;
  top: 86%;
  letter-spacing: .24em;
  font-size: 12px;
  opacity: 0;
  transform: translateY(2px);
  text-shadow: 0 2px 10px rgba(0,0,0,.6);
  pointer-events:none;
  transition: opacity 220ms var(--ease), transform 220ms var(--ease);
  z-index:3;
}

.book-anchor.armed .hint{
  opacity:.52;
  transform: translateY(0);
}

/* =========================
   HOVER MAGIC (ritual)
   ========================= */
.book-anchor:hover .book,
.book-anchor:focus-visible .book{
  transform:
    perspective(1200px)
    rotateX(12deg)
    rotateY(-34deg) /* “rotate more” */
    rotateZ(-2deg)
    translateY(7px);

  filter:
    drop-shadow(0 26px 26px rgba(0,0,0,.38))
    drop-shadow(0 10px 18px rgba(0,0,0,.26))
    drop-shadow(0 0 22px var(--glow))
    drop-shadow(0 0 48px var(--glow2));
}

.book-anchor:hover .shadow-contact,
.book-anchor:focus-visible .shadow-contact{
  opacity:.70;
  filter: blur(14px);
}

.book-anchor:hover .shadow-ambient,
.book-anchor:focus-visible .shadow-ambient{
  opacity:.48;
  filter: blur(22px);
}

/* Click pickup beat (micro lift that feels deliberate) */
.book-anchor.picking .book{
  transform:
    perspective(1200px)
    rotateX(14deg)
    rotateY(-38deg)
    rotateZ(-2deg)
    translateY(-8px)   /* lift */
    translateZ(26px);  /* toward viewer */
}

.book-anchor.picking .shadow-contact{
  opacity:.45;
  filter: blur(18px);
}
.book-anchor.picking .shadow-ambient{
  opacity:.35;
  filter: blur(26px);
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce){
  .book, .shadow-contact, .shadow-ambient, .hint{ transition:none !important; }
  .ember{ animation:none !important; }
}