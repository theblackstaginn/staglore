/* =========================================================
   Stag Lore — Desk + Hot Book (Phase 1) (FIXED)
   - Background: stag-study.png (world)
   - Hot object: hot-book.png (transparent cutout)
   - Embers canvas NEVER shows as a black rectangle:
     it is only visible when JS adds .embers-on
   - Hot-book alignment dials added (hotX/hotY/hotScale/hotRotate)
   ========================================================= */

:root{
  --text: rgba(231,226,219,.92);

  /* Scene tuning */
  --sceneMax: 1200px;

  /* Book placement (anchor position in the scene) */
  --bookLeft: 23%;
  --bookTop: 63%;
  --bookWidth: min(460px, 48vw);

  /* Slight rotation only (NO rotateX — PNG already has perspective) */
  --tiltZ: -7deg;

  /* Hot-book calibration (to cover baked-in book perfectly) */
  --hotX: 0px;          /* left/right */
  --hotY: 0px;          /* up/down */
  --hotScale: 1.00;     /* size */
  --hotRotate: 0deg;    /* micro-rotate */

  /* Glow */
  --glowA: rgba(255, 168, 64, .22);
  --glowB: rgba(255, 120, 40, .12);

  /* Vignette strength */
  --v1: .08;
  --v2: .58;
}

*{ box-sizing:border-box; }
html,body{ height:100%; }

body{
  margin:0;
  background:#050608;
  color:var(--text);
  overflow:hidden;
  font-family: ui-serif, Georgia, "Times New Roman", serif;
}

/* =========================
   BACKGROUND (fixed)
   ========================= */
.bg{
  position:fixed;
  inset:0;
  z-index:-5;
  background: url("./assets/stag-study.png") center / cover no-repeat;
  transform: translateZ(0);
}

/* Atmos overlay (dust / vignette) */
.atmos{
  position:fixed;
  inset:0;
  z-index:-4;
  pointer-events:none;
  background:
    radial-gradient(120% 90% at 50% 10%, rgba(255,255,255,var(--v1)), transparent 60%),
    radial-gradient(120% 120% at 50% 45%, transparent 55%, rgba(0,0,0,var(--v2)) 100%),
    linear-gradient(180deg, rgba(0,0,0,.20), rgba(0,0,0,.26));
  mix-blend-mode: normal;
}

/* =========================
   STAGE LAYOUT
   ========================= */
.stage{
  position:relative;
  height:100%;
  width:100%;
}

.desk-scene{
  position:relative;
  height:100%;
  width:min(var(--sceneMax), 100%);
  margin:0 auto;
}

/* =========================
   BOOK ANCHOR
   ========================= */
.book-anchor{
  position:absolute;
  left:var(--bookLeft);
  top:var(--bookTop);
  transform: translate(-50%, -50%);
  width: var(--bookWidth);
  aspect-ratio: 4 / 3;
  padding:0;
  border:0;
  background:transparent;
  cursor:pointer;
  z-index:10;

  user-select:none;
  -webkit-tap-highlight-color: transparent;
}

/* Book image (transparent PNG cutout) */
.book{
  position:absolute;
  left:50%;
  top:50%;
  width: 100%;
  height:auto;

  transform:
    translate(-50%, -50%)
    translate(var(--hotX), var(--hotY))
    rotateZ(calc(var(--tiltZ) + var(--hotRotate)))
    scale(var(--hotScale));

  transform-origin: 50% 62%;
  display:block;

  filter: drop-shadow(0 18px 26px rgba(0,0,0,.50));
  pointer-events:none;
}

/* Ambient shadow (broad, soft) */
.shadow-ambient{
  position:absolute;
  left:50%;
  top:58%;
  width: 82%;
  height: 28%;
  transform: translate(-50%, -50%) rotateZ(var(--tiltZ));
  border-radius: 50%;
  background: radial-gradient(circle at 50% 50%,
    rgba(0,0,0,.32),
    rgba(0,0,0,0) 70%
  );
  filter: blur(10px);
  opacity: .65;
  z-index:9;
  pointer-events:none;
}

/* Contact shadow (tight) — kills hovering */
.shadow-contact{
  position:absolute;
  left:50%;
  top:62%;
  width: 74%;
  height: 18%;
  transform: translate(-50%, -50%) rotateZ(var(--tiltZ));
  border-radius: 50%;
  background: radial-gradient(circle at 50% 55%,
    rgba(0,0,0,.45),
    rgba(0,0,0,0) 65%
  );
  filter: blur(6px);
  opacity: .92;
  z-index:9;
  pointer-events:none;
}

/* Embers canvas sits above book — INVISIBLE unless JS enables */
.embers{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  z-index:12;
  pointer-events:none;

  opacity:0;
  background: transparent;
  transition: opacity .18s ease;
}

/* Only show canvas when JS says so */
.book-anchor.embers-on .embers{
  opacity:1;
}

/* Optional hint text */
.book-hint{
  position:absolute;
  left:50%;
  top:92%;
  transform: translate(-50%, -50%);
  font-size: 12px;
  letter-spacing: .28em;
  opacity:.42;
  text-transform:uppercase;
  z-index:12;
  pointer-events:none;
}

/* Hover / focus glow (book only; canvas visibility handled by JS) */
.book-anchor:hover .book,
.book-anchor:focus-visible .book{
  filter:
    drop-shadow(0 18px 26px rgba(0,0,0,.52))
    drop-shadow(0 0 22px var(--glowA))
    drop-shadow(0 0 46px var(--glowB));
}

.book-anchor:hover .shadow-contact,
.book-anchor:focus-visible .shadow-contact{
  opacity: .98;
}

.book-anchor:focus-visible{
  outline: 2px solid rgba(255, 190, 120, .22);
  outline-offset: 8px;
  border-radius: 18px;
}

/* Click pulse placeholder (JS toggles .clicked) */
.book-anchor.clicked .book{
  filter:
    drop-shadow(0 18px 26px rgba(0,0,0,.52))
    drop-shadow(0 0 26px rgba(255, 175, 90, .28))
    drop-shadow(0 0 60px rgba(255, 120, 40, .16));
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce){
  .embers{ transition:none; }
  .book-anchor:hover .book{ filter: drop-shadow(0 18px 26px rgba(0,0,0,.52)); }
}

/* Small screens: nudge placement */
@media (max-width: 760px){
  :root{
    --bookLeft: 36%;
    --bookTop: 66%;
    --bookWidth: min(420px, 78vw);
    --tiltZ: -6deg;
  }
  body{ overflow:hidden; }
}